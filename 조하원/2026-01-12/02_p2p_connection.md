# ðŸ“˜ 02_P2P_Connection â€” WebRTC P2P ì—°ê²° êµ¬ì¡°

## âœ”ï¸ P2P ì—°ê²°ì´ëž€?
ë‘ ë¸Œë¼ìš°ì €ê°€ ì„œë¡œ ì§ì ‘ ì—°ê²°(Direct Connection)í•˜ì—¬ ì˜ìƒ/ìŒì„±/ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ëŠ” êµ¬ì¡°ë¥¼ ì˜ë¯¸

- ì„œë²„ë¥¼ ê±°ì¹˜ëŠ” ì¼ë°˜ WebSocket ë°©ì‹ê³¼ ë‹¬ë¦¬ ì¤‘ì•™ ì„œë²„ ì—†ì´ ì§ì ‘ í†µì‹ 
- ì§€ì—°(latency)ì´ ë§¤ìš° ë‚®ìŒ
- ëŒ€ì—­í­ íš¨ìœ¨ì´ ë†’ìŒ
- ë¸Œë¼ìš°ì € ê°„ ì‹ í˜¸ êµí™˜(Signaling)ë§Œ ì„œë²„ í•„ìš”

## ðŸ§© P2P ì—°ê²° ê³¼ì • (Step-by-step)
WebRTCì—ì„œ P2P ì—°ê²°ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” 3ê°€ì§€ ë‹¨ê³„ê°€ í•„ìˆ˜ë‹¤.

### 1ï¸âƒ£ Signaling(ì‹œê·¸ë„ë§)
**ì„œë¡œì˜ ì •ë³´ë¥¼ êµí™˜í•˜ì—¬ ì—°ê²° ì¤€ë¹„ë¥¼ í•˜ëŠ” ê³¼ì •**
í™•ì‹¤í•œ ë‚´ìš© âœ”
ë¸Œë¼ìš°ì €ë¼ë¦¬ ì§ì ‘ ëŒ€í™”ë¥¼ ëª»í•˜ë¯€ë¡œ, ì¤‘ê°„ì—ì„œ ë‘˜ì„ ì—°ê²°í•´ì£¼ëŠ” ìž„ì‹œ ë©”ì‹ ì €ê°€ í•„ìš”

- WebSocket / HTTP / Firebase ë“± ê°€ëŠ¥
- WebRTC ê·œê²©ì—ëŠ” í¬í•¨ X â†’ ì§ì ‘ êµ¬í˜„í•´ì•¼ í•¨
Signalingì—ì„œ êµí™˜ë˜ëŠ” ì •ë³´:
- SDP(Session Description Protocol): ì˜ìƒ/ìŒì„± ì½”ë±, ICE í›„ë³´ ì •ë³´
- ICE candidates(ë„¤íŠ¸ì›Œí¬ í›„ë³´ ì •ë³´)

---

### 2ï¸âƒ£ ICE + STUN/TURN

ë¸Œë¼ìš°ì €ë“¤ì´ ì„œë¡œ ì—°ê²°í•  ìˆ˜ ìžˆëŠ” ê²½ë¡œë¥¼ ì°¾ëŠ” ê³¼ì •

#### â— STUN ì„œë²„
â€œë‚´ê°€ ì§€ê¸ˆ ì–´ë–¤ IP/Portë¡œ ì™¸ë¶€ì—ì„œ ë³´ì´ëŠ”ì§€ ì•Œë ¤ì£¼ëŠ” ì„œë²„â€

- NAT/ë°©í™”ë²½ ë’¤ì— ìžˆì–´ë„ ì™¸ë¶€ ì£¼ì†Œ íŒŒì•… ê°€ëŠ¥
- ë¬´ë£Œ ì œê³µí•˜ëŠ” STUN ì„œë²„ ìžˆìŒ(Google STUN)

#### â— TURN ì„œë²„
â€œP2Pê°€ ë¶ˆê°€ëŠ¥í•  ë•Œ ì¤‘ê³„ ì„œë²„ ì—­í• ì„ ìˆ˜í–‰â€

- í™•ì‹¤í•œ ì •ë³´: NAT íƒ€ìž…ì— ë”°ë¼ P2P ì‹¤íŒ¨ ì‹œ TURN í•„ìˆ˜
- ëŒ€ì—­í­ ì†Œëª¨ ì»¤ì„œ ë¹„ìš© í¼
- WebRTC ì„œë¹„ìŠ¤ë¼ë©´ ì‹¤ë¬´ì—ì„œ ë°˜ë“œì‹œ ê³ ë ¤í•´ì•¼ í•¨

---

### 3ï¸âƒ£ RTCPeerConnection ìƒì„± ë° ì—°ê²°

ë‘ ë¸Œë¼ìš°ì €ê°€ ì‹¤ì œë¡œ ì§ì ‘ ì—°ê²°ë˜ëŠ” ìˆœê°„

#### ì—°ê²° ì ˆì°¨ íë¦„

1. Peer Aê°€ RTCPeerConnection ê°ì²´ ìƒì„±
2. Aê°€ createOffer()ë¡œ SDP ìƒì„±
3. Signaling ì„œë²„ë¥¼ í†µí•´ Peer Bë¡œ ì „ë‹¬
4. Peer Bê°€ setRemoteDescription()ìœ¼ë¡œ Aì˜ SDP ì €ìž¥
5. Peer Bê°€ createAnswer()ë¡œ ì‘ë‹µ SDP ìƒì„±
6. Signaling ì„œë²„ë¥¼ í†µí•´ ë‹¤ì‹œ Peer Aì—ê²Œ ì „ë‹¬
7. ì–‘ìª½ì—ì„œ ICE í›„ë³´ ì •ë³´ë¥¼ êµí™˜
8. ì—°ê²° í™•ë¦½

---

## ðŸ› ï¸ íë¦„ë„ (ê°„ë‹¨/ì •í™•)

```lua
Peer A                           Peer B
------------------------------------------
createOffer()  ----->   offer ì „ë‹¬
                 <-----  createAnswer()
ICE candidate  ----->  ICE candidate
                 <-----  ICE candidate
------- RTCPeerConnection ì—°ê²° ì™„ë£Œ -------
```

---

## ðŸ”Œ P2P ì—°ê²° ì‹œ ì‹¤ì œ ë°ì´í„° íë¦„
ì—°ê²°ì´ ì„±ë¦½ë˜ë©´â€¦

### ðŸŽ¥ ì˜ìƒ/ìŒì„±
- getUserMedia() â†’ PeerConnection.addTrack()
- ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¼ì´ ì§ì ‘ ì „ë‹¬ë¨

### ðŸ“¨ ë°ì´í„° ì „ì†¡
- RTCDataChannel ìƒì„±
- ì‹¤ì‹œê°„ ê²Œìž„Â·í…ìŠ¤íŠ¸Â·íŒŒì¼ ì „ì†¡ ê°€ëŠ¥

---

âš ï¸ P2Pê°€ í•­ìƒ ì„±ê³µí•˜ëŠ” ê±´ ì•„ë‹˜

â€œP2Pë‹ˆê¹Œ ë¬´ì¡°ê±´ ì§ì ‘ ì—°ê²°ë˜ê² ì§€?â€ â†’ âŒ
ë‹¤ìŒ ê²½ìš°ì—” TURN ì„œë²„ê°€ í•„ìš”í•´ì§.

- ì–‘ìª½ NATê°€ symmetric NAT
- ê¸°ì—…ìš© ë°©í™”ë²½ì´ ê°•í•œ ê²½ìš°
- ê³µê³µ ì™€ì´íŒŒì´ í™˜ê²½
TURN ì„œë²„ê°€ ì—†ëŠ” WebRTCëŠ”
â€œì–¸ì œë“  ë¯¸ì…˜ ì‹¤íŒ¨í•  ìˆ˜ ìžˆëŠ” ë¶ˆì•ˆì • ì„œë¹„ìŠ¤â€

---

## ðŸ ê²°ë¡ 
### âœ”ï¸ í•µì‹¬ ì •ë¦¬
- P2P ì—°ê²°ì€ WebRTCì˜ ë³¸ì§ˆ
- Signaling â†’ ICE/STUN/TURN â†’ PeerConnection ìˆœì„œ í•„ìˆ˜
- TURN ì„œë²„ëŠ” ì„ íƒì´ ì•„ë‹ˆë¼ ìµœì•…ì˜ ê²½ìš° ëŒ€ë¹„ìš© í•„ìˆ˜ ìš”ì†Œ