# WebRTC 서버 구성 정리 (STUN / TURN / OpenVidu)

> 오늘 학습 내용 기준으로 WebRTC 인프라 선택과 역할을 정리한 문서

---

## 1. WebRTC 기본 구조 개요

WebRTC는 브라우저 간 **실시간 음성·영상·데이터 통신**을 가능하게 하는 기술이다.

기본 구성 요소는 다음과 같다.

* **Peer (브라우저)**: 실제 통신 주체
* **Signaling Server**: 연결 정보(SDP, ICE candidate) 교환
* **ICE**: 네트워크 경로 후보를 수집·선택하는 메커니즘
* **STUN / TURN**: NAT·방화벽 환경에서 연결을 보조하는 서버

> ⚠️ WebRTC 자체에는 시그널링이 포함되어 있지 않으며, 별도로 구현해야 한다.

---

## 2. STUN 서버란?

### 2-1. 역할

* 클라이언트의 **공인 IP / 포트 정보**를 알려줌
* NAT 뒤에 있는 클라이언트가 **P2P 직접 연결**을 시도할 수 있도록 지원

### 2-2. 특징

* 미디어 데이터는 **서버를 거치지 않음**
* 지연(latency)이 낮고 서버 비용이 거의 없음
* 일부 네트워크 환경(대칭 NAT, 기업망)에서는 연결 실패 가능

### 2-3. 사용 목적 요약

> “서버를 거치지 않고, P2P 연결을 성사시키기 위한 주소 확인용 서버”

---

## 3. TURN 서버란?

### 3-1. 역할

* STUN으로도 연결이 불가능할 경우
* **서버가 미디어 트래픽을 중계(relay)**

### 3-2. 특징

* 연결 성공률이 가장 높음 (최후의 수단)
* 모든 미디어 트래픽이 서버를 통과
* 대역폭 비용 및 서버 부하 증가

### 3-3. 사용 목적 요약

> “P2P가 안 될 때, 무조건 연결을 보장하기 위한 중계 서버”

---

## 4. STUN vs TURN 비교

| 구분     | STUN        | TURN               |
| ------ | ----------- | ------------------ |
| 역할     | 공인 IP/포트 조회 | 미디어 중계             |
| 미디어 경로 | Peer ↔ Peer | Peer ↔ TURN ↔ Peer |
| 서버 부하  | 거의 없음       | 매우 큼               |
| 지연     | 낮음          | 상대적으로 높음           |
| 비용     | 낮음          | 높음                 |
| 용도     | 기본 연결 시도    | 연결 실패 시 대체         |

---

## 5. OpenVidu란?

### 5-1. 개념

OpenVidu는 WebRTC 기반의 **영상 통화 서버 플랫폼**으로,
다음 요소들을 **패키지 형태**로 제공한다.

* SFU(Selective Forwarding Unit) 미디어 서버
* 시그널링 서버
* 세션/룸 관리
* 권한 제어
* 녹화, 통계, 다자간 통화 지원

### 5-2. 핵심 특징

* 기본 구조는 **서버 중계(SFU)** 방식
* P2P 구조를 직접 구현할 필요 없음
* 빠른 서비스 구현에 유리

---

## 6. STUN/TURN vs OpenVidu 차이

> ⚠️ 같은 레벨의 선택지가 아님

* STUN/TURN: **네트워크 연결을 보조하는 인프라 요소**
* OpenVidu: **영상 통화 서버 + 시그널링 + 기능 묶음 플랫폼**

| 구분    | STUN / TURN | OpenVidu   |
| ----- | ----------- | ---------- |
| 성격    | 연결 보조 인프라   | 영상 통화 플랫폼  |
| 구조    | P2P 중심      | SFU(서버 중계) |
| 시그널링  | 직접 구현 필요    | 포함         |
| 녹화/관리 | 직접 구현       | 기본 제공      |
| 난이도   | 높음          | 상대적으로 낮음   |
| 확장성   | 낮음          | 높음         |

---

## 7. 프로젝트 기준 선택 가이드

### 7-1. STUN/TURN이 적합한 경우

* 1:1 통화 중심
* 서버 비용 최소화가 중요
* WebRTC 내부 구조를 직접 구현·학습하고 싶은 경우

> 필수 추가 구현 요소
>
> * 시그널링 서버(WebSocket 등)
> * 룸/세션 관리
> * 재접속 처리

---

### 7-2. OpenVidu가 적합한 경우

* 다자간 통화 가능성 있음
* 녹화, 권한 제어, 화면 공유 필요
* 빠른 MVP 구현과 안정성이 중요

---

## 8. 결론 요약

* **STUN**: P2P 연결을 위한 주소 조회
* **TURN**: P2P 실패 시 서버 중계
* **OpenVidu**: WebRTC 서버 기능을 한 번에 제공하는 플랫폼

> ✔️ 단순 1:1 + 학습 목적 → STUN/TURN

> ✔️ 서비스 완성도·확장성 중시 → OpenVidu
