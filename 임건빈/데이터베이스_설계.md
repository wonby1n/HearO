# 데이터베이스 설계

효과적인 데이터베이스 설계를 위해서는 다음과 같은 원칙을 생각해봐야 한다.

1. 데이터 모델링 : 실제 세계의 개체와 그들의 관계를 정확하게 표현해야 함
2. 정규화 : 데이터 중복을 최소화 하고 데이터 무결성을 보장하기 위한 정규화 과정 
3. 인덱싱 : 빠른 데이터 검색을 위한 적절한 인덱스 설정
4. 보안 : 데이터 접근 권한을 세밀하게 제어하여 보안을 강화
5. 확장성 : 미래의 데이터 증가를 대비하여 확장 가능한 구조로 설계 

사용하는 도구 중 하나 

**ERD ( Entity-Relationship Diagram) 개체 관계 다이어 그램**

ERD의 세가지 주요 요소 

1. 엔티티(Entity) : 실제 세계의 객체나 개념을 나타냄 → 사각형으로 표현 ex) 학생, 강의, 교수
2. 속성(Attribute) : 엔티티의 특성이나 성질은 나타냄 → 타원형으로 표현 ex) 학생 엔티티의 경우 ‘학번’, ‘이름’, ‘전공’
3. 관계(Relationship) : 엔티티 간의 연관성을 나타냄 . ‘학생’과 ‘강의’ 사이의 ‘수강한다’와 같은 관계가 여기에 해당한다. →  마름모 형태로 표현

**관계는 3가지 종류로 분류된다.**

1. 일대일 관계 : 한 엔티티의 하나의 인스턴스가 다른 엔티티의 하나의 인스턴스와 연관 ex) 학생과 학생증 - > 학생은 하나의 학생증만 가능 . 학생증은 하나의 학생에 대응
2. 일대다 관계 : 한 엔티티의 하나의 인스턴스가 다른 엔티티의 다수의 인스턴스와 연관 ex) 교수와 강의 → 교수는 여러 강의를 맡는다. 강의는 교수 한명이 담당
3. 다대다 관계 : 양쪽 엔티티의 여러 인스턴스가 서로 연관 ex) ‘학생’과 ‘강의’ 학생은 여러 강의 수강 . 강의에는 여러명의 학생이 있음

**ERD 작성 시 고려사항**

1. 엔티티 식별 : 시스템에서 중요한 **객체**나 **개념**을 엔티티로 정의 
2. 속성 선정 : 각 엔티티의 중요한 특성을 속성으로 선정 - 선정 시 불필요한 중복 피해야 함
3. 관계 정의 : 엔티티 간의 논리적 연관성 파악 후 관계 정의
4. 카디널리티 표시 : 관계의 수량적인 특성(몇대몇 관계인지) 명확히 표시한다.
5. 참여도 고려 : 각 엔티티가 관계에 필수적으로 참여하는지(전체 참여), 선택적으로 참여하는지(부분 참여)를 구분함 

**ERD 에서 논리적 모델로의 전환**

ERD는 개념적 모델링 단계에서 사용 - 이를 바탕으로 논리적 데이터 모델을 생성 - 생성 과정에서 다음과 같은 변환이 일어난다.

1. 엔티티는 테이블로 변환
2. 속성은 테이블의 컬럼이 됨
3. **일대다 관계는 외래 키를 통해 구현**
4. **다대다 관계는 중간 테이블을 생성하여 해결**

**데이터 정규화**

1 2 3 정규화 BCNF 뒤에 더 있지만 사실 순서까지는 너무 얽매이지 않고 뭘 하면 되는지 안 해야 되는지 생각하자

1. 데이터 중복 제거 
2. 데이터 무결성 유지
3. 데이터 일관성 보장
4. 데이터 갱신 이상 방지
5. 효율적인 데이터 구조 설계

제 1 정규형

1. 각 열은 원자값을 가져야 함
2. 같은 데이터(레코드 또는  행)이 여러 열에 반복되지 않아야 함

제 2 정규형

1. 부분 함수 종속성 제거 

모든 비주요 속성(주요키를 제외한)이 주요 키에 완전 함수 종속이어야 함 

기본키가 여러 개의 속성(열)으로 구성 될 때 기본키의 부분 집합(U-전체 집합 제외)에 대해 어떤 비주요 속성이 결정이 되면 안됨 

제 3 정규형

1. 이행적 함수 종속성 제거 - 비주요 속성 간의 종속성이 없어야 함 

**비정규화를 하는 경우**

1. 조인 연산이 과도하게 많은 경우
2. 데이터 검색 속도가 중요한 경우
3. 데이터 일관성보다 읽기 성능이 우선시 되는 겅우

**비정규화 기법**

1. 테이블 병합 - 두 개 이상의 테이블을 하나로 병합하여 조인 연산을 줄인다.
2. 컬럼 중복 - 자주 조인되는 테이블의 컬럼을 다른 테이블에 중복하여 추가한다.
3. 계산된 컬럼 추가 - 자주 계산되는 값을 미리 계산하여 저장한다.
4. 테이블 분할 - 큰 테이블을 수직 또는 수평으로 분할하여 성능 개선

**비정규화의 장점**

1. 조인 연산 감소로 인한 쿼리 성능 향상
2. 데이터 검색 속도 개선 
3. 복잡한 쿼리 단순화

**비정규화의 단점**

1. 데이터 중복으로 인한 저장 공간 증가
2. 데이터 일관성 유지의 어려움 
3. 데이터 갱신, 삽입, 삭제 작업의 복잡성 증가 

**비정규화 적용 시 고려 사항 - trade-off 를 신중하게 평가하자** 

1. 데이터의 사용 패턴 분석 : 읽기 작업과 쓰기 작업의 비율 고려 
2. 성능 측정 : 비정규화 전후의 성능을 정확히 측정하여 효과를 확인 
3. 데이터 일관성 유지 방안 : 트리거나 애플리케이션 로직을 통해 데이터 일관성을 유지
4. 비정규화의 범위 : 필요한 부분에만 적용해라
5. 향후 확장성 : 시스템의 미래 요구사항 고려 

비정규화는 정규화까지 다한 데이터베이스 설계를 끝내고 하는 것을 권장 

정규화(완료) → 성능 문제 발견(실제로 애플리케이션을  구동하거나 쿼리를 짜는) - > 비정규화(선택)

**짧은 프로젝트(6주)를 위한 비정규화 전략**

1. 일단 정규화로 시작하라 - 6주 프로젝트는 데이터 양이 수백만 건이 넘지 않을 가능성이 크다 . 
- 요즘 DB 성능이 좋아서 3~4개 테이블 JOIN 정도는 성능에 큰 문제가 없음 
2. 자주 쓰이는 합산 값만 비정규화 ex) 게시글의 댓글 수 , 좋아요 수 
3. 데이터 일관성은 애플리케이션 로직에서 처리 ex) DB 트리거는 디버깅이 어렵고 프로젝트 관리 부담 됨
댓글이 달릴 때 게시글의 comment_count를 +1 해주는 로직을 서비스 코드에서 관리하는 것이 팀프로젝트의 유지보수 측면에서 훨씬 유리 
4. 성능 측정이 어렵다면 조인 횟수를 기준으로 삼으라