## S3 저장소 활용

음성 파일 저장소 대용량 미디어 데이터 보관에 최적 무제한 확장성 및 비용 효율성 보장 높은 데이터 내구성으로 손실 위험 방지 개별 파일 URL을 통한 직접 접근 및 스트리밍 지원

저장 방식 선택 백엔드 경유: 보안 검증 및 데이터 정합성 유지 유리 Presigned URL: 서버 부하를 최소화하며 S3로 직접 업로드

## Java(Spring Boot) 연동

AWS SDK 활용 소프트웨어 아마존 SDK v2 라이브러리 사용 S3Client 객체를 통해 파일 전송 및 경로 관리 Access Key 등 보안 정보는 외부 설정 파일(yml)로 관리

## 실시간 통신 솔루션 비교

OpenVidu LiveKit 기반의 통합 관리 플랫폼 녹화 기능과 S3 연동이 기본 내장되어 있어 빠른 개발 가능 Java 개발자를 위한 강력한 SDK 및 문서 제공

LiveKit 고성능 WebRTC 미디어 엔진 실시간 음성 스트림 가로채기(Agents)에 최적화 초대형 서비스 확장성 및 낮은 지연 시간 보장

## 실시간 음성 분석 및 마스킹

도구 선택 기준 단순 녹화 저장보다 실시간 데이터 조작이 핵심인 경우 LiveKit이 유리 음성 스트림을 실시간으로 낚아채서 분석하고 다시 돌려주는 파이프라인 구축 필요

CLOVA Speech 연동 gRPC 스트리밍 API를 통해 실시간 한국어 STT 지원 LiveKit(통로)과 CLOVA(분석 엔진)를 조합하는 아키텍처 추천 분석된 결과에 따라 욕설 구간 음성을 무음 처리하거나 텍스트 마스킹 수행

---

## STT(Speech-to-Text) 선택

**STT가 뭐냐**
- 음성을 텍스트로 변환하는 기술
- 욕설 감지하려면 필수

**선택지 4가지**

### 1. Clova Streaming API (추천!)
```
레이턴시: 310-510ms
정확도: 90-95%
한국어 욕설: ⭐⭐⭐⭐⭐ (최강)
가격: 15원/분
실시간: ✅ (WebSocket)

장점:
- 한국어 특화 (욕설 변형 감지 최고)
- "시X", "개새" 같은 변형도 잘 잡음
- 국내 서버 (레이턴시 낮음)
- 가격 저렴

단점:
- 글로벌 서비스면 부적합
```

### 2. Google Speech-to-Text Streaming
```
레이턴시: 250-400ms (더 빠름)
정확도: 85-90%
한국어 욕설: ⭐⭐⭐⭐☆
가격: 24원/분 (비쌈)
실시간: ✅ (Streaming)

장점:
- 레이턴시 가장 낮음
- 안정적 (글로벌 인프라)
- 다국어 지원

단점:
- 한국어 욕설 변형은 Clova보다 약함
- 비쌈
```

### 3. Whisper (OpenAI)
```
레이턴시: 5-10초 (GPU 필요)
정확도: 95-98% (최고)
한국어 욕설: ⭐⭐⭐⭐⭐
가격: 무료 (GPU 비용만)
실시간: ❌ (파일 전체 필요)

장점:
- 정확도 최고
- 오픈소스

단점:
- 실시간 불가능 (너무 느림)
- GPU 필수
```

### 4. Web Speech API (브라우저)
```
레이턴시: 50-100ms (가장 빠름)
정확도: 70-80% (낮음)
한국어 욕설: ⭐⭐☆☆☆
가격: 무료
실시간: ✅

장점:
- 빠름
- 무료

단점:
- 정확도 낮음
- 욕설 변형 감지 약함
- Safari 미지원
```

**비교표**
| STT | 레이턴시 | 정확도 | 한국어 욕설 | 실시간 | 가격 | 추천도 |
|-----|----------|--------|-------------|--------|------|--------|
| Clova | 310-510ms | 90-95% | ⭐⭐⭐⭐⭐ | ✅ | 15원/분 | ⭐⭐⭐⭐⭐ |
| Google | 250-400ms | 85-90% | ⭐⭐⭐⭐☆ | ✅ | 24원/분 | ⭐⭐⭐⭐☆ |
| Whisper | 5-10초 | 95-98% | ⭐⭐⭐⭐⭐ | ❌ | 무료(GPU) | ⭐⭐☆☆☆ |
| Web Speech | 50-100ms | 70-80% | ⭐⭐☆☆☆ | ✅ | 무료 | ⭐⭐☆☆☆ |

**최종 추천**

**실시간 프로젝트 + 한국어 특화 → Clova Streaming**
- 레이턴시 0.5초 이내 (충분히 빠름)
- 한국어 욕설 감지 최강
- 가격 저렴 (Google의 62%)
- 국내 서버 (안정적)

**글로벌 서비스 → Google Streaming**
- 레이턴시 조금 더 빠름
- 다국어 지원
- 안정성 최고

---

## WebRTC 구현 방식 선택

**WebRTC가 뭐냐**
- Web Real-Time Communication
- 브라우저끼리 직접 음성/영상 주고받는 기술
- P2P (Peer-to-Peer) 또는 서버 중계 방식

**구현 방법 2가지**

### 방법 1: LiveKit 사용 (추천)
```
장점:
- SDK가 다 해줌 (개발 2-3주 단축)
- 자동 재연결, 네트워크 품질 관리
- TURN/STUN 내장 (NAT 통과 문제 없음)
- 안정적 (검증된 솔루션)

단점:
- 벤더 종속성 있음 (근데 오픈소스라 괜찮음)
- Self-hosted 하면 EC2 비용 (~$30-70/월)

개발 시간: 2-3주
```

### 방법 2: Vanilla WebRTC (직접 구현)
```
장점:
- 완전한 제어 가능
- 커스터마이징 자유로움
- 벤더 종속성 없음

단점:
- 개발 시간 4-6주
- WebRTC 전문 지식 필요
- NAT Traversal 구현 어려움
- 재연결 로직 직접 구현
- 네트워크 품질 관리 직접 구현
- TURN 서버 별도 설치 (Coturn)

개발 시간: 4-6주
```

**Vanilla WebRTC의 어려운 점**

**1. NAT Traversal (80%의 난이도)**
```
문제: 공유기/방화벽 뒤에 있으면 서로 못 찾음

해결 과정:
1. STUN으로 공인 IP 찾기
2. ICE candidate 모으기 (10-20개씩 비동기로 모임)
3. 대칭형 NAT는 STUN으로 안 뚫림 → TURN 서버 필요
4. ICE 협상 타이밍 맞추기 (순서 틀리면 실패)

실전 문제:
- "집에서는 되는데 회사에서 안 돼요" (방화벽)
- "5초 후에 연결돼요" (ICE gathering 느림)
- "갑자기 끊겨요" (NAT 바인딩 타임아웃)
```

**2. 재연결 로직 (15%의 난이도)**
```
문제: 네트워크 끊기면 자동 복구 안 됨

해결:
- ICE restart 시도
- 일정 시간 대기 후 재연결
- 실패하면 PeerConnection 새로 생성
- 모든 이벤트 핸들러 다시 등록
```

**3. 시그널링 서버 구현 (5%의 난이도)**
```
Spring Boot + WebSocket으로 구현:
- offer/answer 중계
- ICE candidate 브로드캐스트
- 방(Room) 관리
- 참가자 연결/해제 처리
```

**결론: LiveKit 써라**
- 6주 프로젝트면 시간 부족
- WebRTC 전문가 없으면 디버깅 지옥
- 핵심 기능(욕설 감지, STT, AI 요약)에 집중해야 함

---

## 4. LiveKit 이해하기

**LiveKit이 뭐냐**
- WebRTC 미디어 서버 (SFU)
- 음성/영상 중계 + 시그널링 + TURN/STUN 다 내장
- 오픈소스 (Apache 2.0)

**LiveKit의 역할**
```
[고객] → [LiveKit 서버] → [상담원]
         (음성 중계)

LiveKit이 하는 일:
1. 음성 스트림 중계 (SFU)
2. 시그널링 (offer/answer 교환)
3. NAT 통과 (TURN/STUN 내장)
4. 재연결 자동 처리
5. 네트워크 품질 자동 조정
```